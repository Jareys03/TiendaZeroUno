<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${direccion.id} == null ? 'Nueva dirección' : 'Editar dirección'">
    Formulario dirección
  </title>
  <link rel="stylesheet"
        th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" th:href="@{/}">Tienda</a>
    <div>
      <a class="nav-link text-light d-inline" th:href="@{/productos}">Productos</a>
      <a class="nav-link text-light d-inline" th:href="@{/usuarios}">Usuarios</a>
    </div>
  </div>
</nav>

<div class="container">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-0"
          th:text="${direccion.id} == null ? 'Nueva dirección' : 'Editar dirección'">
        Nueva dirección
      </h1>
      <p class="text-muted mb-0">
        Usuario:
        <strong th:text="${usuario.nombre}">Nombre Usuario</strong>
        (<span th:text="${usuario.correo}">correo@ejemplo.com</span>)
      </p>
    </div>
    <div>
      <a class="btn btn-secondary"
         th:href="@{/usuarios/{uid}/direcciones(uid=${usuario.id})}">
        Volver a direcciones
      </a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">

      <form th:object="${direccion}"
            th:action="${direccion.id} == null ?
                        @{/usuarios/{uid}/direcciones(uid=${usuario.id})} :
                        @{/usuarios/{uid}/direcciones/{did}/actualizar(uid=${usuario.id}, did=${direccion.id})}"
            method="post">

        <div class="mb-3">
          <label for="calle" class="form-label">Calle</label>
          <input type="text" id="calle" class="form-control"
                 th:field="*{calle}" placeholder="Avda. del Circuito 1" required>
        </div>

        <div class="mb-3">
          <label for="ciudad" class="form-label">Ciudad</label>
          <input type="text" id="ciudad" class="form-control"
                 th:field="*{ciudad}" placeholder="Badajoz" required>
        </div>

        <!-- Campo oculto por si quieres forzar la relación -->
        <input type="hidden" th:value="${usuario.id}" name="usuario.id"/>

        <div class="d-flex justify-content-end">
          <a class="btn btn-outline-secondary me-2"
             th:href="@{/usuarios/{uid}/direcciones(uid=${usuario.id})}">
            Cancelar
          </a>
          <button type="submit" class="btn btn-primary"
                  th:text="${direccion.id} == null ? 'Crear' : 'Guardar cambios'">
            Crear
          </button>
        </div>

      </form>

    </div>
  </div>

</div>

</body>
</html>
